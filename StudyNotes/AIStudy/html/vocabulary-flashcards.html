<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单词卡片学习工具</title>
    <!-- 引入外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- 配置Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6366F1',
                        success: '#10B981',
                        danger: '#EF4444',
                        neutral: '#64748B',
                        light: '#F8FAFC',
                        dark: '#1E293B'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-flip {
                transform-style: preserve-3d;
                transition: transform 0.6s;
            }
            .card-flipped {
                transform: rotateY(180deg);
            }
            .card-front, .card-back {
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
            }
            .card-back {
                transform: rotateY(180deg);
            }
            .progress-animation {
                transition: width 0.5s ease-in-out;
            }
            .pulse-animation {
                animation: pulse 1.5s infinite;
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-light to-gray-100 min-h-screen text-dark">
    <!-- 顶部导航栏 -->
    <header class="bg-white/80 backdrop-blur-md shadow-sm fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="fa fa-book text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-primary">单词卡片学习</h1>
            </div>
            <div class="flex items-center gap-4">
                <button id="clearCacheBtn" class="hidden md:flex items-center gap-1 px-3 py-1.5 text-sm bg-neutral/10 hover:bg-neutral/20 text-neutral rounded-full transition-all">
                    <i class="fa fa-trash"></i>
                    <span>清除缓存</span>
                </button>
                <button id="restartBtn" class="hidden md:flex items-center gap-1 px-3 py-1.5 text-sm bg-primary/10 hover:bg-primary/20 text-primary rounded-full transition-all">
                    <i class="fa fa-refresh"></i>
                    <span>重新开始</span>
                </button>
                <button id="settingsBtn" class="p-2 text-neutral hover:text-primary rounded-full transition-colors">
                    <i class="fa fa-cog"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-24 pb-16 min-h-screen flex flex-col items-center justify-center">
        <!-- 初始设置区域 -->
        <section id="setupSection" class="w-full max-w-2xl">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 transform transition-all duration-500 hover:shadow-xl">
                <h2 class="text-2xl font-bold mb-6 text-center text-dark">单词学习设置</h2>
                
                <div class="mb-6">
                    <label for="wordList" class="block text-sm font-medium text-neutral mb-2">输入单词列表（每行一个，格式：单词,释义）</label>
                    <textarea id="wordList" rows="8" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all resize-none" placeholder="例如：
apple,苹果
book,书
computer,电脑">apple,苹果
banana,香蕉
computer,电脑
book,书
pen,钢笔
school,学校
teacher,老师
student,学生
friend,朋友
family,家庭
happy,快乐的
sad,悲伤的
big,大的
small,小的
fast,快的</textarea>
                </div>
                
                <div class="mb-6">
                    <label for="voiceLang" class="block text-sm font-medium text-neutral mb-2">发音语言</label>
                    <select id="voiceLang" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all">
                        <option value="en-US">英语 (美国)</option>
                        <option value="en-GB">英语 (英国)</option>
                        <option value="zh-CN">中文 (普通话)</option>
                        <option value="ja-JP">日语</option>
                        <option value="ko-KR">韩语</option>
                    </select>
                </div>
                
                <button id="startBtn" class="w-full py-3 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
                    <span>开始学习</span>
                    <i class="fa fa-arrow-right"></i>
                </button>
                
                <div id="cacheNotice" class="mt-4 text-sm text-neutral text-center hidden">
                    <i class="fa fa-info-circle mr-1"></i> 已加载上次学习记录
                </div>
            </div>
        </section>

        <!-- 卡片学习区域 -->
        <section id="cardSection" class="w-full max-w-md hidden">
            <!-- 进度指示器 -->
            <div class="mb-6 w-full">
                <div class="flex justify-between text-sm text-neutral mb-1">
                    <span id="currentProgress">1/10</span>
                    <span id="percentageProgress">10%</span>
                </div>
                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-primary progress-animation w-0"></div>
                </div>
            </div>
            
            <!-- 单词卡片 -->
            <div class="relative h-64 md:h-80 w-full perspective">
                <div id="card" class="card-flip absolute w-full h-full">
                    <!-- 卡片正面 - 单词 -->
                    <div class="card-front absolute w-full h-full bg-white rounded-2xl shadow-lg p-6 md:p-8 flex flex-col justify-center items-center text-center transition-all duration-300">
                        <div class="text-neutral text-sm mb-2">单词</div>
                        <h3 id="word" class="text-3xl md:text-4xl font-bold mb-4 text-dark"></h3>
                        <button id="playWordBtn" class="mb-4 p-3 bg-primary/10 hover:bg-primary/20 text-primary rounded-full transition-all">
                            <i class="fa fa-volume-up"></i>
                        </button>
                        <button id="flipBtn" class="mt-2 text-primary hover:text-primary/80 text-sm flex items-center gap-1 transition-colors">
                            <span>查看释义</span>
                            <i class="fa fa-chevron-down"></i>
                        </button>
                    </div>
                    
                    <!-- 卡片背面 - 释义 -->
                    <div class="card-back absolute w-full h-full bg-white rounded-2xl shadow-lg p-6 md:p-8 flex flex-col justify-center items-center text-center transition-all duration-300">
                        <div class="text-neutral text-sm mb-2">释义</div>
                        <p id="definition" class="text-2xl md:text-3xl font-medium mb-6 text-dark"></p>
                        <button id="playDefinitionBtn" class="mb-4 p-3 bg-primary/10 hover:bg-primary/20 text-primary rounded-full transition-all">
                            <i class="fa fa-volume-up"></i>
                        </button>
                        <button id="flipBackBtn" class="text-primary hover:text-primary/80 text-sm flex items-center gap-1 transition-colors">
                            <i class="fa fa-chevron-up"></i>
                            <span>返回单词</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 操作按钮 -->
            <div class="mt-8 flex gap-4">
                <button id="dontKnowBtn" class="flex-1 py-3 bg-danger/10 hover:bg-danger/20 text-danger font-medium rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
                    <i class="fa fa-times"></i>
                    <span>不懂</span>
                </button>
                <button id="knowBtn" class="flex-1 py-3 bg-success/10 hover:bg-success/20 text-success font-medium rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
                    <i class="fa fa-check"></i>
                    <span>懂</span>
                </button>
            </div>
        </section>

        <!-- 结果展示区域 -->
        <section id="resultsSection" class="w-full max-w-2xl hidden">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 transform transition-all duration-500">
                <h2 class="text-2xl font-bold mb-6 text-center text-dark">学习结果</h2>
                
                <!-- 统计图表 -->
                <div class="mb-8">
                    <div class="h-64">
                        <canvas id="resultsChart"></canvas>
                    </div>
                </div>
                
                <!-- 统计数据 -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center">
                    <div class="bg-light rounded-xl p-4">
                        <div class="text-neutral text-sm mb-1">总单词数</div>
                        <div id="totalWords" class="text-2xl font-bold text-dark"></div>
                    </div>
                    <div class="bg-success/10 rounded-xl p-4">
                        <div class="text-success text-sm mb-1">已掌握</div>
                        <div id="knownWords" class="text-2xl font-bold text-success"></div>
                    </div>
                    <div class="bg-danger/10 rounded-xl p-4">
                        <div class="text-danger text-sm mb-1">未掌握</div>
                        <div id="unknownWords" class="text-2xl font-bold text-danger"></div>
                    </div>
                    <div class="bg-primary/10 rounded-xl p-4">
                        <div class="text-primary text-sm mb-1">正确率</div>
                        <div id="accuracyRate" class="text-2xl font-bold text-primary"></div>
                    </div>
                </div>
                
                <!-- 未掌握单词列表 -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3 text-dark">需要复习的单词</h3>
                    <div id="unknownWordsList" class="max-h-40 overflow-y-auto pr-2 space-y-2">
                        <!-- 未掌握的单词将在这里动态显示 -->
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex gap-4">
                    <button id="reviewUnknownBtn" class="flex-1 py-3 bg-danger/10 hover:bg-danger/20 text-danger font-medium rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
                        <i class="fa fa-repeat"></i>
                        <span>复习未掌握</span>
                    </button>
                    <button id="restartAllBtn" class="flex-1 py-3 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
                        <i class="fa fa-refresh"></i>
                        <span>重新学习全部</span>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white/80 backdrop-blur-md py-4 text-center text-neutral text-sm">
        <div class="container mx-auto px-4">
            <p>单词卡片学习工具 &copy; 2023</p>
        </div>
    </footer>

    <script>
        // 应用状态
        const appState = {
            words: [],          // 所有单词列表
            currentIndex: 0,    // 当前单词索引
            results: [],        // 学习结果记录
            unknownWords: [],   // 未掌握的单词
            voiceLang: 'en-US', // 默认语音语言
            lastActivity: null  // 最后活动时间
        };

        // DOM元素
        const elements = {
            setupSection: document.getElementById('setupSection'),
            cardSection: document.getElementById('cardSection'),
            resultsSection: document.getElementById('resultsSection'),
            wordList: document.getElementById('wordList'),
            voiceLang: document.getElementById('voiceLang'),
            startBtn: document.getElementById('startBtn'),
            restartBtn: document.getElementById('restartBtn'),
            restartAllBtn: document.getElementById('restartAllBtn'),
            reviewUnknownBtn: document.getElementById('reviewUnknownBtn'),
            clearCacheBtn: document.getElementById('clearCacheBtn'),
            cacheNotice: document.getElementById('cacheNotice'),
            word: document.getElementById('word'),
            definition: document.getElementById('definition'),
            flipBtn: document.getElementById('flipBtn'),
            flipBackBtn: document.getElementById('flipBackBtn'),
            card: document.getElementById('card'),
            knowBtn: document.getElementById('knowBtn'),
            dontKnowBtn: document.getElementById('dontKnowBtn'),
            currentProgress: document.getElementById('currentProgress'),
            percentageProgress: document.getElementById('percentageProgress'),
            progressBar: document.getElementById('progressBar'),
            totalWords: document.getElementById('totalWords'),
            knownWords: document.getElementById('knownWords'),
            unknownWords: document.getElementById('unknownWords'),
            accuracyRate: document.getElementById('accuracyRate'),
            unknownWordsList: document.getElementById('unknownWordsList'),
            resultsChart: document.getElementById('resultsChart'),
            playWordBtn: document.getElementById('playWordBtn'),
            playDefinitionBtn: document.getElementById('playDefinitionBtn')
        };

        // 缓存相关常量
        const CACHE_KEY = 'vocabularyFlashcardsData';
        const CACHE_EXPIRY_DAYS = 7; // 缓存有效期7天

        // 初始化应用
        function initApp() {
            // 从缓存加载数据
            loadFromCache();
            
            // 绑定事件监听器
            elements.startBtn.addEventListener('click', startLearning);
            elements.restartBtn.addEventListener('click', restartLearning);
            elements.restartAllBtn.addEventListener('click', restartLearning);
            elements.reviewUnknownBtn.addEventListener('click', reviewUnknown);
            elements.flipBtn.addEventListener('click', flipCard);
            elements.flipBackBtn.addEventListener('click', flipCard);
            elements.knowBtn.addEventListener('click', () => recordResult(true));
            elements.dontKnowBtn.addEventListener('click', () => recordResult(false));
            elements.playWordBtn.addEventListener('click', playCurrentWord);
            elements.playDefinitionBtn.addEventListener('click', playCurrentDefinition);
            elements.voiceLang.addEventListener('change', (e) => {
                appState.voiceLang = e.target.value;
                saveToCache(); // 保存语音设置
            });
            elements.clearCacheBtn.addEventListener('click', clearCache);
            
            // 检查浏览器是否支持语音合成
            if (!('speechSynthesis' in window)) {
                alert('很抱歉，您的浏览器不支持语音合成功能');
                elements.playWordBtn.disabled = true;
                elements.playDefinitionBtn.disabled = true;
            }
        }

        // 从缓存加载数据
        function loadFromCache() {
            try {
                const cachedData = localStorage.getItem(CACHE_KEY);
                if (cachedData) {
                    const parsedData = JSON.parse(cachedData);
                    const now = new Date().getTime();
                    const cacheAge = (now - parsedData.timestamp) / (1000 * 60 * 60 * 24);
                    
                    // 检查缓存是否过期
                    if (cacheAge <= CACHE_EXPIRY_DAYS) {
                        // 恢复应用状态
                        appState.words = parsedData.words || [];
                        appState.currentIndex = parsedData.currentIndex || 0;
                        appState.results = parsedData.results || [];
                        appState.unknownWords = parsedData.unknownWords || [];
                        appState.voiceLang = parsedData.voiceLang || 'en-US';
                        
                        // 恢复UI状态
                        elements.voiceLang.value = appState.voiceLang;
                        
                        // 如果有单词列表，恢复到文本框
                        if (appState.words.length > 0) {
                            const wordListText = appState.words.map(word => 
                                `${word.word},${word.definition}`
                            ).join('\n');
                            elements.wordList.value = wordListText;
                            elements.cacheNotice.classList.remove('hidden');
                        }
                        
                        // 如果有学习进度，直接恢复到相应的界面
                        if (appState.results.length > 0 && appState.results.length < appState.words.length) {
                            // 有未完成的学习，恢复到卡片界面
                            elements.setupSection.classList.add('hidden');
                            elements.cardSection.classList.remove('hidden');
                            elements.restartBtn.classList.remove('hidden');
                            displayCurrentWord();
                            updateProgress();
                        } else if (appState.results.length === appState.words.length && appState.words.length > 0) {
                            // 已完成学习，显示结果界面
                            elements.setupSection.classList.add('hidden');
                            elements.resultsSection.classList.remove('hidden');
                            elements.restartBtn.classList.remove('hidden');
                            showResults();
                        }
                    }
                }
            } catch (error) {
                console.error('加载缓存失败:', error);
                // 缓存加载失败时不做处理，使用默认状态
            }
        }

        // 保存数据到缓存
        function saveToCache() {
            try {
                const dataToCache = {
                    words: appState.words,
                    currentIndex: appState.currentIndex,
                    results: appState.results,
                    unknownWords: appState.unknownWords,
                    voiceLang: appState.voiceLang,
                    timestamp: new Date().getTime() // 记录缓存时间
                };
                localStorage.setItem(CACHE_KEY, JSON.stringify(dataToCache));
            } catch (error) {
                console.error('保存缓存失败:', error);
            }
        }

        // 清除缓存
        function clearCache() {
            if (confirm('确定要清除所有学习记录吗？此操作不可恢复。')) {
                try {
                    localStorage.removeItem(CACHE_KEY);
                    // 重置应用状态
                    appState.words = [];
                    appState.currentIndex = 0;
                    appState.results = [];
                    appState.unknownWords = [];
                    appState.voiceLang = 'en-US';
                    
                    // 重置UI
                    elements.voiceLang.value = 'en-US';
                    elements.cacheNotice.classList.add('hidden');
                    elements.setupSection.classList.remove('hidden');
                    elements.cardSection.classList.add('hidden');
                    elements.resultsSection.classList.add('hidden');
                    elements.restartBtn.classList.add('hidden');
                    
                    alert('缓存已清除');
                } catch (error) {
                    console.error('清除缓存失败:', error);
                    alert('清除缓存失败，请重试');
                }
            }
        }

        // 解析单词列表
        function parseWordList(input) {
            const lines = input.trim().split('\n');
            return lines.map(line => {
                const [word, definition] = line.split(',').map(item => item.trim());
                return { word, definition };
            }).filter(item => item.word && item.definition);
        }

        // 开始学习
        function startLearning() {
            const wordListText = elements.wordList.value.trim();
            if (!wordListText) {
                alert('请输入单词列表');
                return;
            }

            // 解析单词列表
            appState.words = parseWordList(wordListText);
            if (appState.words.length === 0) {
                alert('请输入有效的单词列表（格式：单词,释义）');
                return;
            }

            // 保存选择的语音语言
            appState.voiceLang = elements.voiceLang.value;

            // 重置状态
            appState.currentIndex = 0;
            appState.results = [];
            appState.unknownWords = [];

            // 保存到缓存
            saveToCache();

            // 显示卡片区域，隐藏设置区域
            elements.setupSection.classList.add('hidden');
            elements.cardSection.classList.remove('hidden');
            elements.restartBtn.classList.remove('hidden');

            // 显示第一个单词
            displayCurrentWord();
            updateProgress();
        }

        // 显示当前单词
        function displayCurrentWord() {
            const currentWord = appState.words[appState.currentIndex];
            elements.word.textContent = currentWord.word;
            elements.definition.textContent = currentWord.definition;
            
            // 重置卡片状态
            elements.card.classList.remove('card-flipped');
            
            // 添加卡片进入动画
            elements.card.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                elements.card.classList.remove('scale-95', 'opacity-0');
            }, 50);
        }

        // 播放当前单词
        function playCurrentWord() {
            const currentWord = appState.words[appState.currentIndex].word;
            playText(currentWord, appState.voiceLang);
            
            // 添加播放按钮动画
            elements.playWordBtn.classList.add('pulse-animation');
            setTimeout(() => {
                elements.playWordBtn.classList.remove('pulse-animation');
            }, 1500);
        }

        // 播放当前释义
        function playCurrentDefinition() {
            const currentDefinition = appState.words[appState.currentIndex].definition;
            // 对于中文释义，使用中文语音
            const lang = appState.voiceLang.startsWith('zh') ? 'zh-CN' : appState.voiceLang;
            playText(currentDefinition, lang);
            
            // 添加播放按钮动画
            elements.playDefinitionBtn.classList.add('pulse-animation');
            setTimeout(() => {
                elements.playDefinitionBtn.classList.remove('pulse-animation');
            }, 1500);
        }

        // 文本语音播放
        function playText(text, lang) {
            // 停止任何正在播放的语音
            window.speechSynthesis.cancel();
            
            // 创建语音实例
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            
            // 尝试找到匹配的语音
            const voices = window.speechSynthesis.getVoices();
            const voice = voices.find(v => v.lang.startsWith(lang));
            if (voice) {
                utterance.voice = voice;
            }
            
            // 播放语音
            window.speechSynthesis.speak(utterance);
        }

        // 翻转卡片
        function flipCard() {
            elements.card.classList.toggle('card-flipped');
        }

        // 记录学习结果
        function recordResult(known) {
            appState.results.push(known);
            
            if (!known) {
                appState.unknownWords.push(appState.words[appState.currentIndex]);
            }
            
            // 保存到缓存
            saveToCache();
            
            // 检查是否还有下一个单词
            if (appState.currentIndex < appState.words.length - 1) {
                appState.currentIndex++;
                displayCurrentWord();
                updateProgress();
            } else {
                // 显示学习结果
                showResults();
            }
        }

         
        function updateProgress() {
            const current = appState.currentIndex + 1;
            const total = appState.words.length;
            const percentage = Math.round((current / total) * 100);
            
            
            elements.currentProgress.textContent = `${current}/${total}`;
            elements.percentageProgress.textContent = `${percentage}%`;
            elements.progressBar.style.width = `${percentage}%`;
        }

        // 显示学习结果
        function showResults() {
            // 隐藏卡片区域，显示结果区域
            elements.cardSection.classList.add('hidden');
            elements.resultsSection.classList.remove('hidden');
            
            // 计算统计数据
            const total = appState.results.length;
            const known = appState.results.filter(result => result).length;
            const unknown = total - known;
            const accuracy = total > 0 ? Math.round((known / total) * 100) : 0;
            
            // 更新统计数据显示
            elements.totalWords.textContent = total;
            elements.knownWords.textContent = known;
            elements.unknownWords.textContent = unknown;
            elements.accuracyRate.textContent = `${accuracy}%`;
            
            // 显示未掌握的单词
            displayUnknownWords();
            
            // 绘制结果图表
            drawResultsChart(known, unknown);
            
            // 保存到缓存
            saveToCache();
        }

        // 显示未掌握的单词
        function displayUnknownWords() {
            elements.unknownWordsList.innerHTML = '';
            
            if (appState.unknownWords.length === 0) {
                elements.unknownWordsList.innerHTML = '<p class="text-neutral italic">恭喜！你已经掌握了所有单词。</p>';
                return;
            }
            
            appState.unknownWords.forEach(word => {
                const wordElement = document.createElement('div');
                wordElement.className = 'bg-danger/5 p-3 rounded-lg flex justify-between items-center';
                wordElement.innerHTML = `
                    <div>
                        <span class="font-medium">${word.word}</span>
                        <span class="text-sm text-neutral ml-2">${word.definition}</span>
                    </div>
                    <button class="play-unknown-word p-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-full transition-all" 
                            data-word="${word.word}" data-definition="${word.definition}">
                        <i class="fa fa-volume-up"></i>
                    </button>
                `;
                elements.unknownWordsList.appendChild(wordElement);
            });
            
            // 为未掌握单词列表中的播放按钮绑定事件
            document.querySelectorAll('.play-unknown-word').forEach(btn => {
                btn.addEventListener('click', function() {
                    const word = this.getAttribute('data-word');
                    playText(word, appState.voiceLang);
                    
                    // 添加按钮动画
                    this.classList.add('pulse-animation');
                    setTimeout(() => {
                        this.classList.remove('pulse-animation');
                    }, 1500);
                });
            });
        }

        // 绘制结果图表
        function drawResultsChart(known, unknown) {
            const ctx = elements.resultsChart.getContext('2d');
            
            // 销毁已存在的图表
            if (window.resultsChartInstance) {
                window.resultsChartInstance.destroy();
            }
            
            // 创建新图表
            window.resultsChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['已掌握', '未掌握'],
                    datasets: [{
                        data: [known, unknown],
                        backgroundColor: ['#10B981', '#EF4444'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // 重新学习
        function restartLearning() {
            elements.resultsSection.classList.add('hidden');
            elements.setupSection.classList.remove('hidden');
            elements.restartBtn.classList.add('hidden');
            // 不清除缓存，只重置界面状态
        }

        // 复习未掌握的单词
        function reviewUnknown() {
            if (appState.unknownWords.length === 0) {
                alert('没有未掌握的单词');
                return;
            }
            
            // 使用未掌握的单词重新开始学习
            appState.words = [...appState.unknownWords];
            appState.currentIndex = 0;
            appState.results = [];
            appState.unknownWords = [];
            
            // 保存到缓存
            saveToCache();
            
            // 显示卡片区域，隐藏结果区域
            elements.resultsSection.classList.add('hidden');
            elements.cardSection.classList.remove('hidden');
            
            // 显示第一个单词
            displayCurrentWord();
            updateProgress();
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', initApp);
    
        // 预加载语音列表
        window.speechSynthesis.onvoiceschanged = function() {
            // 语音列表加载完成
        };
    </script>
</body>
</html>
